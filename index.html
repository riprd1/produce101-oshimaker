<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>日プ新世界 推しメーカー</title>

<style>
/* ===== ここからCSS（あなたのマスターコード完全そのまま） ===== */
:root{
  --bg:#f6f6f6;
  --card:#ffffff;
  --line:#e6e6e6;
  --text:#111;
  --muted:#666;
  --shadow: 0 4px 14px rgba(0,0,0,.06);
  --radius:14px;
  --blue:#0080ff;
  --slot:82px;
  --gap:16px;
}
*{box-sizing:border-box;}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);}

header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:10;}
.topbar{padding:12px;max-width:980px;margin:auto;}
h1{margin:0;font-size:20px}
.by{font-size:12px;color:var(--muted)}

main{max-width:980px;margin:auto;padding:12px;}

.card{background:#fff;border:1px solid var(--line);border-radius:14px;overflow:hidden;}

.banner{
  height:110px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:url("https://i.imgur.com/nYBRUdd.png") center/cover;
}
.bannerTitle{
  background:rgba(255,255,255,.8);
  padding:8px 14px;
  border-radius:999px;
  font-weight:900;
}

.pyramidWrap{padding:10px}
.pyramid{display:flex;flex-direction:column;gap:var(--gap);align-items:center}
.row{display:flex;gap:var(--gap)}

.slot{width:var(--slot);text-align:center}

.avatar{
  width:var(--slot);
  height:var(--slot);
  border-radius:999px;
  border:5px solid var(--blue);
  overflow:visible;
  position:relative;
}
.avatar img{
  width:100%;
  height:100%;
  border-radius:999px;
  object-fit:cover;
  object-position:50% 35%;
}

.rank{
  position:absolute;
  left:50%;
  bottom:-12px;
  transform:translateX(-50%);
  background:var(--blue);
  color:#fff;
  font-size:10px;
  font-weight:900;
  padding:5px 8px;
  border-radius:999px;
}

.name{
  font-size:12px;
  font-weight:700;
  margin-top:14px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.actions{display:flex;gap:10px;justify-content:center;padding:10px}

.listCard{margin-top:12px;border:1px solid var(--line);border-radius:14px;padding:10px}
.search input{width:100%;padding:8px;border-radius:10px;border:1px solid #ddd}
#membersWrap{max-height:50vh;overflow:auto}

.memberRow{display:flex;gap:10px;padding:8px 0;cursor:pointer}
.memberRow img{width:50px;height:50px;border-radius:50%;object-fit:cover}

/* ===== 保存専用エリア ===== */
#exportArea{
  position:fixed;
  left:-9999px;
  width:1004px;
  height:1040px;
}
#exportInner{
  width:1004px;
  height:1040px;
  background:#fff;
  padding:40px;
}
.exportRow{display:flex;justify-content:center;gap:40px;margin-bottom:40px}
.exportAvatar{
  width:130px;height:130px;border-radius:999px;border:8px solid var(--blue);
  background-size:cover;background-position:center;
  position:relative;
}
.exportRank{
  position:absolute;left:50%;bottom:-14px;transform:translateX(-50%);
  background:var(--blue);color:#fff;padding:6px 10px;border-radius:999px;font-weight:900;
}
/* ===== CSSここまで ===== */
</style>
</head>

<body>

<header>
  <div class="topbar">
    <h1>日プ新世界 推しメーカー</h1>
    <div class="by">created by @12agassi</div>
  </div>
</header>

<main>
  <div class="card">
    <div class="banner"><div class="bannerTitle">AUDITION PICK • YOUR TOP 11</div></div>

    <div class="pyramidWrap">
      <div id="pyramid" class="pyramid"></div>
    </div>

    <div class="actions">
      <button onclick="saveImage()">画像として保存</button>
      <button onclick="undo()">1人戻す</button>
      <button onclick="resetAll()">リセット</button>
    </div>
  </div>

  <div class="listCard">
    <div class="search"><input id="search" placeholder="Search" oninput="drawMembers()"></div>
    <div id="membersWrap"><div id="members"></div></div>
  </div>
</main>

<div id="exportArea">
  <div id="exportInner">
    <div id="exportPyramid"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
const trainees=[
{name:"アダム・ナガイ(ADAM)",img:"https://i.imgur.com/6QGzvRx.png"},
{name:"中丸 晏寿(AJU)",img:"https://i.imgur.com/KiZCKos.png"},
{name:"オム・スアンカワーテン(AOM)",img:"https://i.imgur.com/dDIFJSc.png"},
{name:"アーチャー・ウイ(ARCHER)",img:"https://i.imgur.com/5iIerqN.png"},
{name:"篠ヶ谷 歩夢(S.AYUMU)",img:"https://i.imgur.com/YJAdh8q.png"},
{name:"小林 千悟(CHISATO)",img:"https://i.imgur.com/Iu0hNBO.png"},
{name:"加藤 大樹(K.DAIKI)",img:"https://i.imgur.com/4fRk2EB.png"},
{name:"カク・ドンミン(DONGMIN)",img:"https://i.imgur.com/xZSQqMh.png"},
{name:"末川 瑛太(EITA)",img:"https://i.imgur.com/alEjKCP.png"},
{name:"保里 瑛都(H.EITO)",img:"https://i.imgur.com/IAhs4ZA.png"},
{name:"金田 栄都(K.EITO)",img:"https://i.imgur.com/tF7i1du.png"},
{name:"櫻井 楓真(FUMA)",img:"https://i.imgur.com/WIWI8Sx.png"}
];

const rowSizes=[1,2,3,5];
let selected=[];

/* ===== 高画質保存（scale:4 ← ここだけ変更） ===== */
async function saveImage(){
  drawExport();
  const canvas = await html2canvas(document.getElementById("exportInner"),{
    backgroundColor:"#fff",
    scale:4   // ★★★ 高画質化 ★★★
  });
  const a=document.createElement("a");
  a.href=canvas.toDataURL();
  a.download="oshimaker.png";
  a.click();
}

/* ===== 以下ロジックそのまま ===== */
function drawMembers(){
  const wrap=document.getElementById("members");
  wrap.innerHTML="";
  trainees.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className="memberRow";
    d.innerHTML=`<img src="${t.img}"><div>${t.name}</div>`;
    d.onclick=()=>add(i);
    wrap.appendChild(d);
  });
}
function add(i){
  if(selected.length>=11)return;
  if(selected.includes(i))return;
  selected.push(i);
  draw();
}
function undo(){selected.pop();draw();}
function resetAll(){selected=[];draw();}

function draw(){
  const p=document.getElementById("pyramid");
  p.innerHTML="";
  let idx=0;
  rowSizes.forEach(s=>{
    const row=document.createElement("div");
    row.className="row";
    for(let k=0;k<s;k++){
      const slot=document.createElement("div");
      slot.className="slot";
      if(selected[idx]!=null){
        const t=trainees[selected[idx]];
        slot.innerHTML=`<div class="avatar"><img src="${t.img}"><div class="rank">${idx+1}</div></div><div class="name">${t.name}</div>`;
      }
      row.appendChild(slot);
      idx++;
    }
    p.appendChild(row);
  });
}

function drawExport(){
  const p=document.getElementById("exportPyramid");
  p.innerHTML="";
  let idx=0;
  rowSizes.forEach(s=>{
    const row=document.createElement("div");
    row.className="exportRow";
    for(let k=0;k<s;k++){
      const d=document.createElement("div");
      if(selected[idx]!=null){
        const t=trainees[selected[idx]];
        d.innerHTML=`<div class="exportAvatar" style="background-image:url('${t.img}')"><div class="exportRank">${idx+1}</div></div>`;
      }
      row.appendChild(d);
      idx++;
    }
    p.appendChild(row);
  });
}

drawMembers();
draw();
</script>
</body>
</html>
