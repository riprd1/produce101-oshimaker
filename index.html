<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>日プ新世界 推しメーカー</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root{
  --blue:#1a73e8;
  --size: clamp(60px, 15vw, 92px); /* ★自動縮小（切れ防止） */
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#f6f6f6;
}

/* =====================
   HEADER
===================== */
header{
  position:sticky;
  top:0;
  background:#fff;
  z-index:100;
  border-bottom:1px solid #ddd;
  padding:12px 16px;
}
.by{font-size:12px;color:#666;margin-top:4px}

/* =====================
   BANNER
===================== */
.banner{
  height:100px;
  background:url("https://i.imgur.com/nYBRUdd.png") center/cover;
  display:flex;
  align-items:center;
  justify-content:center;
}
.bannerTitle{
  background:#fff;
  padding:10px 18px;
  border-radius:999px;
  font-weight:900;
}

/* =====================
   PYRAMID (sticky固定)
===================== */
.pyramidWrap{
  position:sticky;
  top:120px;
  background:#fff;
  padding:18px 0 32px;
  z-index:50;
}

.pyramid{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:20px;
}

.row{
  display:flex;
  justify-content:center;
  gap: calc(var(--size)*0.25);
}

.slot{
  width:var(--size);
  text-align:center;
}

/* 丸 */
.avatar{
  width:var(--size);
  height:var(--size);
  border-radius:50%;
  border:5px solid #ddd;
  overflow:hidden;
  background:#fff;
  position:relative;
}
.avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* ★順位 真ん中下 */
.rank{
  position:absolute;
  left:50%;
  bottom:-10px;
  transform:translateX(-50%);
  background:var(--blue);
  color:#fff;
  border-radius:999px;
  padding:4px 9px;
  font-size:12px;
  font-weight:900;
  border:3px solid #fff;
}

/* 名前 */
.name{
  margin-top:14px;
  font-size:12px;
  font-weight:800;
  word-break:break-word;
}

/* 空 */
.empty .avatar{
  opacity:.15;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
}
.empty .rank,.empty .name{display:none}

/* =====================
   BUTTONS
===================== */
.actions{
  text-align:center;
  margin-top:14px;
}
button{
  padding:10px 16px;
  margin:4px;
  border-radius:10px;
  border:1px solid #ccc;
  background:#fff;
}

/* =====================
   SEARCH + LIST
===================== */
.listWrap{
  background:#fff;
  margin-top:10px;
}

.search{
  padding:10px;
}
.search input{
  width:100%;
  padding:10px;
  border:1px solid #ccc;
  border-radius:10px;
}

#members{
  max-height:45vh;
  overflow:auto;
}

.member{
  display:flex;
  align-items:center;
  padding:10px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}
.member img{
  width:50px;height:50px;border-radius:50%;
  margin-right:10px;object-fit:cover;
}
.member.selected{
  opacity:.3;
  pointer-events:none;
}

/* =====================
   EXPORT (保存専用1004x924)
===================== */
#exportArea{
  position:fixed;
  left:-9999px;
  top:0;
  width:1004px;
  height:924px;
  background:#fff;
  padding:30px;
}
.exportPyramid .avatar{
  width:120px;height:120px;
}
.exportPyramid .rank{
  bottom:-14px;
}
</style>
</head>

<body>

<header>
  <b>日プ新世界 推しメーカー</b>
  <div class="by">created by @12agassi</div>
</header>

<div class="banner">
  <div class="bannerTitle">AUDITION PICK • YOUR TOP 11</div>
</div>

<div class="pyramidWrap">
  <div id="pyramid" class="pyramid"></div>

  <div class="actions">
    <button onclick="saveImage()">画像として保存</button>
    <button onclick="undo()">1人戻す</button>
    <button onclick="resetAll()">リセット</button>
  </div>
</div>

<div class="listWrap">
  <div class="search">
    <input id="search" placeholder="Search" oninput="drawMembers()">
  </div>
  <div id="members"></div>
</div>

<!-- 保存専用 -->
<div id="exportArea">
  <div id="exportPyramid" class="pyramid exportPyramid"></div>
</div>

<script>
const rows=[1,2,3,5];

const trainees=[
{name:"アダム・ナガイ(ADAM)",img:"https://i.imgur.com/6QGzvRx.png"},
{name:"中丸 晏寿(AJU)",img:"https://i.imgur.com/KiZCKos.png"},
{name:"オム・スアンカワーテン(AOM)",img:"https://i.imgur.com/dDIFJSc.png"},
{name:"アーチャー・ウイ(ARCHER)",img:"https://i.imgur.com/5iIerqN.png"},
{name:"篠ヶ谷 歩夢(S.AYUMU)",img:"https://i.imgur.com/YJAdh8q.png"},
{name:"小林 千悟(CHISATO)",img:"https://i.imgur.com/Iu0hNBO.png"},
{name:"加藤 大樹(K.DAIKI)",img:"https://i.imgur.com/4fRk2EB.png"},
{name:"カク・ドンミン(DONGMIN)",img:"https://i.imgur.com/xZSQqMh.png"},
{name:"末川 瑛太(EITA)",img:"https://i.imgur.com/alEjKCP.png"},
{name:"保里 瑛都(H.EITO)",img:"https://i.imgur.com/IAhs4ZA.png"},
{name:"金田 栄都(K.EITO)",img:"https://i.imgur.com/tF7i1du.png"},
{name:"櫻井 楓真(FUMA)",img:"https://i.imgur.com/WIWI8Sx.png"}
];

let selected=[];

function displayName(n){
  return n.replace(/\(.+?\)/,'');
}

function draw(target="pyramid"){
  const p=document.getElementById(target);
  p.innerHTML="";
  let i=0;

  rows.forEach(r=>{
    const row=document.createElement("div");
    row.className="row";
    for(let k=0;k<r;k++){
      const s=document.createElement("div");
      s.className="slot";

      if(i<selected.length){
        const m=trainees[selected[i]];
        s.innerHTML=`
          <div class="avatar">
            <img src="${m.img}">
            <div class="rank">${i+1}</div>
          </div>
          <div class="name">${displayName(m.name)}</div>
        `;
      }else{
        s.classList.add("empty");
        s.innerHTML=`<div class="avatar">＋</div>`;
      }
      row.appendChild(s);
      i++;
    }
    p.appendChild(row);
  });
}

function drawMembers(){
  const q=document.getElementById("search").value.toLowerCase();
  const box=document.getElementById("members");
  box.innerHTML="";

  trainees.forEach((m,i)=>{
    if(q && !m.name.toLowerCase().includes(q)) return;

    const d=document.createElement("div");
    d.className="member";
    if(selected.includes(i)) d.classList.add("selected");

    d.innerHTML=`<img src="${m.img}">${displayName(m.name)}`;
    d.onclick=()=>{
      if(selected.length<11){
        selected.push(i);
        draw();
        draw("exportPyramid");
        drawMembers();
      }
    };
    box.appendChild(d);
  });
}

function saveImage(){
  draw("exportPyramid");
  html2canvas(document.getElementById("exportArea"),{scale:2}).then(c=>{
    const a=document.createElement("a");
    a.href=c.toDataURL();
    a.download="oshimaker.png";
    a.click();
  });
}

function undo(){selected.pop();draw();drawMembers();}
function resetAll(){selected=[];draw();drawMembers();}

draw();
drawMembers();
</script>

</body>
</html>
