<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>日プ新世界 推しメーカー</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root{
  --blue:#1a73e8;
}

/* ========= 基本 ========= */
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#fff;
}

/* ========= ヘッダー ========= */
header{
  text-align:center;
  padding:14px 10px;
  border-bottom:1px solid #eee;
}
header h1{
  margin:0;
  font-size:20px;
}
.by{
  font-size:12px;
  color:#666;
}

/* ========= 上部固定エリア ========= */
.topFixed{
  position:sticky;
  top:0;
  background:#fff;
  z-index:10;
}

/* ========= バナー ========= */
.banner{
  height:90px;
  background-size:cover;
  background-position:center;
  display:flex;
  align-items:center;
  justify-content:center;
}
.banner span{
  background:rgba(255,255,255,.85);
  padding:6px 14px;
  border-radius:999px;
  font-weight:700;
  font-size:13px;
}

/* ========= ピラミッド ========= */
.pyramid{
  padding:12px 6px 16px;
  display:flex;
  flex-direction:column;
  gap:16px;
  align-items:center;
}

.row{
  display:flex;
  justify-content:center;
  gap:18px;
}

/* ⭐ 公式サイズ再現（小さめ） */
.slot{
  width:78px;
  text-align:center;
  position:relative;
}

.avatar{
  width:78px;
  height:78px;
  border-radius:50%;
  border:5px solid #ddd;
  overflow:hidden;
  background:#f6f6f6;
  position:relative;
}

.avatar img{
  width:100%;
  height:100%;
  object-fit:cover; /* ⭐ 潰れ防止 */
}

/* ⭐ 順位 真ん中下 完全固定 */
.rank{
  position:absolute;
  bottom:-10px;
  left:50%;
  transform:translateX(-50%);
  background:var(--blue);
  color:#fff;
  border-radius:999px;
  font-size:12px;
  font-weight:bold;
  padding:4px 9px;
  border:3px solid #fff;
}

/* ⭐ 名前 自動フィット */
.name{
  margin-top:14px;
  font-size:11px;
  font-weight:600;
  line-height:1.2;
  word-break:break-word;
}

/* ========= ボタン ========= */
.controls{
  text-align:center;
  padding:10px;
}
button{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid #ddd;
  background:#fff;
  font-size:13px;
}

/* ========= 一覧 ========= */
.listWrap{
  border-top:1px solid #eee;
  height:40vh;
  overflow-y:auto;
  padding:8px;
}

.search{
  width:100%;
  padding:8px;
  border-radius:10px;
  border:1px solid #ddd;
  margin-bottom:8px;
}

.member{
  display:flex;
  align-items:center;
  gap:10px;
  padding:6px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}

.member img{
  width:48px;
  height:48px;
  border-radius:50%;
  object-fit:cover;
}

/* ========= 保存専用 ========= */
#export{
  position:fixed;
  left:-9999px;
  width:1080px;
  height:1080px;
  background:#fff;
}
.exportWrap{
  padding:60px 60px 100px;
}
.credit{
  position:absolute;
  bottom:20px;
  left:0;
  right:0;
  text-align:center;
  color:#666;
}
</style>
</head>

<body>

<header>
  <h1>日プ新世界 推しメーカー</h1>
  <div class="by">created by @12agassi</div>
</header>

<div class="topFixed">
  <div class="banner" style="background-image:url('https://i.imgur.com/nYBRUdd.png')">
    <span>AUDITION PICK • YOUR TOP 11</span>
  </div>

  <div class="pyramid" id="pyramid"></div>

  <div class="controls">
    <button onclick="saveImage()">画像保存</button>
  </div>
</div>

<!-- ===== 一覧 ===== -->
<div class="listWrap">
  <input class="search" placeholder="Search" oninput="filterMembers(this.value)" />
  <div id="members"></div>
</div>

<!-- 保存専用 -->
<div id="export"></div>

<script>

/* ===== 練習生データ ===== */
const trainees = [
  {name:"アダム・ナガイ",img:"https://i.imgur.com/6QGzvRx.png"},
  {name:"中丸 晏寿",img:"https://i.imgur.com/KiZCKos.png"},
  {name:"オム・スアンカワーテン",img:"https://i.imgur.com/dDIFJSc.png"},
  {name:"アーチャー・ウイ",img:"https://i.imgur.com/5iIerqN.png"},
  {name:"篠ヶ谷 歩夢",img:"https://i.imgur.com/YJAdh8q.png"}
];

let selected=[];

const layout=[1,2,3,5];

function drawPyramid(){
  const p=document.getElementById("pyramid");
  p.innerHTML="";
  let idx=0;

  layout.forEach(size=>{
    const row=document.createElement("div");
    row.className="row";

    for(let i=0;i<size;i++){
      const slot=document.createElement("div");
      slot.className="slot";

      if(selected[idx]!=null){
        const t=trainees[selected[idx]];
        slot.innerHTML=`
          <div class="avatar">
            <img src="${t.img}">
            <div class="rank">${idx+1}</div>
          </div>
          <div class="name">${t.name}</div>
        `;
      }else{
        slot.innerHTML=`<div class="avatar"></div>`;
      }
      row.appendChild(slot);
      idx++;
    }
    p.appendChild(row);
  });
}

/* ===== 一覧 ===== */
function drawMembers(list=trainees){
  const el=document.getElementById("members");
  el.innerHTML="";
  list.forEach((t,i)=>{
    const div=document.createElement("div");
    div.className="member";
    div.innerHTML=`<img src="${t.img}"><span>${t.name}</span>`;
    div.onclick=()=>add(i);
    el.appendChild(div);
  });
}

function add(i){
  if(selected.length>=11)return;
  selected.push(i);
  drawPyramid();
}

/* ===== 検索 ===== */
function filterMembers(q){
  q=q.toLowerCase();
  drawMembers(trainees.filter(t=>t.name.toLowerCase().includes(q)));
}

/* ===== 保存 ===== */
async function saveImage(){
  const exportDiv=document.getElementById("export");
  exportDiv.innerHTML=document.querySelector(".topFixed").innerHTML;

  const canvas=await html2canvas(exportDiv,{scale:2});
  const a=document.createElement("a");
  a.href=canvas.toDataURL();
  a.download="oshimaker.png";
  a.click();
}

drawMembers();
drawPyramid();

</script>
</body>
</html>
