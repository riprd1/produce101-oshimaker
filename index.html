<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>日プ新世界 推しメーカー</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f6f6f6;
  height:100vh;
  display:flex;
  flex-direction:column;
}

/* ================= ヘッダー ================= */
header{
  height:60px;
  background:#fff;
  border-bottom:1px solid #eee;
  padding:10px 16px;
  position:sticky;
  top:0;
  z-index:10;
}
header h1{margin:0;font-size:18px}
header small{color:#666}

/* ================= レイアウト 5:5 ================= */
.container{
  flex:1;
  display:flex;
  flex-direction:column;
}

.topArea{
  height:50vh;
  overflow:hidden;
  background:#fff;
  border-bottom:1px solid #eee;
}

.bottomArea{
  height:50vh;
  overflow:auto;
  background:#fff;
}

/* ================= ピラミッド ================= */

:root{
  --size: clamp(58px, 14vw, 84px);
}

.row{
  display:flex;
  justify-content:center;
  gap:16px;
  margin:12px 0;
}

.slot{
  width:var(--size);
  text-align:center;
}

.avatar{
  width:var(--size);
  height:var(--size);
  border-radius:50%;
  border:5px solid #ddd;
  overflow:hidden;
  margin:auto;
  position:relative;
}

.avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* 順位バッジ */
.rank{
  position:absolute;
  left:50%;
  bottom:-6px;
  transform:translateX(-50%);
  background:#1a73e8;
  color:#fff;
  border-radius:999px;
  padding:4px 9px;
  font-size:12px;
  font-weight:bold;
  border:2px solid #fff;
}

/* 名前1行 */
.name{
  font-size:12px;
  font-weight:bold;
  margin-top:8px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* ================= ボタン ================= */
.actions{
  text-align:center;
  padding:8px;
}
button{
  margin:4px;
  padding:8px 12px;
}

/* ================= 検索 ================= */
.search{
  padding:8px;
}
.search input{
  width:100%;
  padding:8px;
  font-size:14px;
}

/* ================= 一覧 ================= */
.member{
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}
.member img{
  width:48px;
  height:48px;
  border-radius:50%;
}
.member.selected{
  opacity:.3;
  pointer-events:none;
}

/* ================= 保存用 ================= */
#export{
  position:fixed;
  left:-9999px;
  width:1004px;
  height:924px;
  background:#fff;
  padding:60px;
}
.exportRow{
  display:flex;
  justify-content:center;
  gap:40px;
  margin:26px 0;
}
.exportAvatar{
  width:120px;height:120px;border-radius:50%;
  border:7px solid #ddd;overflow:hidden;position:relative;
}
.exportAvatar img{width:100%;height:100%;object-fit:cover;}
.exportRank{
  position:absolute;left:50%;bottom:-6px;transform:translateX(-50%);
  background:#1a73e8;color:#fff;border-radius:999px;
  padding:6px 12px;border:3px solid #fff;font-weight:bold;
}
.exportName{
  text-align:center;font-size:14px;font-weight:bold;margin-top:8px;
}
</style>
</head>

<body>

<header>
  <h1>日プ新世界 推しメーカー</h1>
  <small>created by @12agassi</small>
</header>

<div class="container">

  <!-- ================= 上：ピラミッド ================= -->
  <div class="topArea">
    <div id="pyramid"></div>

    <div class="actions">
      <button onclick="saveImage()">画像として保存</button>
      <button onclick="undo()">1人戻す</button>
      <button onclick="resetAll()">リセット</button>
    </div>
  </div>

  <!-- ================= 下：一覧 ================= -->
  <div class="bottomArea">
    <div class="search">
      <input placeholder="Search" oninput="drawList(this.value)">
    </div>
    <div id="members"></div>
  </div>

</div>

<div id="export"></div>

<script>
const trainees=[
{name:"アダム・ナガイ(ADAM)",img:"https://i.imgur.com/6QGzvRx.png"},
{name:"中丸 晏寿(AJU)",img:"https://i.imgur.com/KiZCKos.png"},
{name:"オム・スアンカワーテン(AOM)",img:"https://i.imgur.com/dDIFJSc.png"},
{name:"アーチャー・ウイ(ARCHER)",img:"https://i.imgur.com/5iIerqN.png"},
{name:"篠ヶ谷 歩夢(S.AYUMU)",img:"https://i.imgur.com/YJAdh8q.png"},
{name:"小林 千悟(CHISATO)",img:"https://i.imgur.com/Iu0hNBO.png"},
{name:"加藤 大樹 (K.DAIKI)",img:"https://i.imgur.com/4fRk2EB.png"},
{name:"カク・ドンミン(DONGMIN)",img:"https://i.imgur.com/xZSQqMh.png"},
{name:"末川 瑛太(EITA)",img:"https://i.imgur.com/alEjKCP.png"},
{name:"保里 瑛都(H.EITO)",img:"https://i.imgur.com/IAhs4ZA.png"},
{name:"金田 栄都(K.EITO)",img:"https://i.imgur.com/tF7i1du.png"},
{name:"櫻井 楓真(FUMA)",img:"https://i.imgur.com/WIWI8Sx.png"}
];

const rows=[1,2,3,5];
let selected=[];

function clean(n){return n.replace(/\([^)]*\)/g,"")}

/* ===== ピラミッド描画 ===== */
function draw(){
 const p=document.getElementById("pyramid");
 p.innerHTML="";
 let i=0;

 rows.forEach(r=>{
  const row=document.createElement("div");
  row.className="row";

  for(let k=0;k<r;k++){
    const s=document.createElement("div");
    s.className="slot";

    if(selected[i]!=null){
      const t=trainees[selected[i]];
      s.innerHTML=`
        <div class="avatar">
          <img src="${t.img}">
          <div class="rank">${i+1}</div>
        </div>
        <div class="name">${clean(t.name)}</div>
      `;
    }else{
      s.innerHTML=`<div class="avatar" style="opacity:.2"></div>`;
    }

    row.appendChild(s);
    i++;
  }
  p.appendChild(row);
 });
}

/* ===== 一覧 ===== */
function drawList(q=""){
 const m=document.getElementById("members");
 m.innerHTML="";
 q=q.toLowerCase();

 trainees.forEach((t,i)=>{
   if(q && !t.name.toLowerCase().includes(q)) return;

   const d=document.createElement("div");
   d.className="member";
   if(selected.includes(i)) d.classList.add("selected");

   d.innerHTML=`<img src="${t.img}"><div>${clean(t.name)}</div>`;

   d.onclick=()=>{
     if(selected.includes(i)) return;
     if(selected.length>=11) return;
     selected.push(i);
     draw();
     drawList();
   };

   m.appendChild(d);
 });
}

/* ===== 操作 ===== */
function undo(){selected.pop();draw();drawList();}
function resetAll(){selected=[];draw();drawList();}

/* ===== 保存 ===== */
async function saveImage(){
 const ex=document.getElementById("export");
 ex.innerHTML="";
 let i=0;

 rows.forEach(r=>{
  const row=document.createElement("div");
  row.className="exportRow";

  for(let k=0;k<r;k++){
    if(selected[i]!=null){
      const t=trainees[selected[i]];
      row.innerHTML+=`
        <div>
          <div class="exportAvatar">
            <img src="${t.img}">
            <div class="exportRank">${i+1}</div>
          </div>
          <div class="exportName">${clean(t.name)}</div>
        </div>`;
    }
    i++;
  }
  ex.appendChild(row);
 });

 const canvas=await html2canvas(ex,{scale:2});
 const a=document.createElement("a");
 a.download="oshimaker.png";
 a.href=canvas.toDataURL();
 a.click();
}

draw();
drawList();
</script>

</body>
</html>
